# 微服务简介

本节主要介绍微服务架构。

# 单体架构

## 简介

在软件设计中，经常提及和使用经典的 3 层模型，即**表示层、业务逻辑层和数据访问层**。

* 表示层：用于直接和用户交互，也称为交互层，通常是网页、UI 等。
* 业务逻辑层：即业务逻辑处理层，例如用户输入的信息要经过业务逻辑层的处理后，才能展现给用户。
* 数据访问层：用于操作数据库，用户在表示层会产生大量的数据，通过数据访问层对数据库进行读写操作。

## 存在的不足

随着应用业务的发展和业务复杂度的提高，这种架构明显存在很多的不足，主要体现在以下3个方面：

* 业务越来越复杂，单体应用的代码量越来越大，**代码的可读性、可维护性和可扩展性下降**，新人接手代码所需的时间成倍增加，业务扩展带来的代价越来越大。
* 随着用户量激增，程序承受的并发量激增，单体应用的**并发能力成为瓶颈**。
* **测试难度大**，单体应用的业务都在同一个程序中，随着业务不断扩张、复杂度增加，导致单体应用修改业务必定或多或少地给其他业务带来影响，导致测试难度大。

## 单体集群架构的不足

针对上述的单体架构，进行改进，引入集群部署+负载均衡的技术，一定程度上提高系统的并发量和性能。但是仍然存在以下问题：

* 系统仍然是单体应用，没有改变代码的可读性、可维护性和可扩展性差的问题。
* 面对海量用户，数据库访问会成为瓶颈，需要采用分布式数据库，分库分表来解决。
* 持续交付能力差，业务代码复杂，新功能开发周期长，测试验证难度大。

# 微服务

## 概念

Microservices: a definition of this new architectural term

> * The term "Microservice Architecture" has sprung up over the last few years to describe a particular way of designing software applications as suites of independently deployable services. While there is no precise definition of this architectural style, there are certain common characteristics around organization around business capability, automated deployment, intelligence in the endpoints, and decentralized control of languages and data.

微服务架构的风格，就是将单一程序开发成一个微服务，每个微服务运行在自己的进程中，并使用轻量级机制通信，通常是HTTP RESTFUL API。这些服务围绕业务能力来划分构建的，并通过完全自动化部署机制来独立部署。这些服务可以使用不同的编程语言，以及不同数据存储技术，以保证低限度的集中式管理。

## 特点

* 按照业务来划分服务，单个服务代码量小，业务单一，易于维护。
* 每个微服务都有自己独立的基组件，例如数据库、缓存等，且运行在独立的进程中。
* 微服务之间的通信是通过HTTP协议或者消息组件，且具有容错能力。
* 微服务有一套服务治理的解决方案，服务之间不耦合，可以随时加入和剔除服务。
* 单个微服务能够集群化部署，并且有负载均衡的能力。
* 整个微服务系统应该有一个完整的安全机制，包括用户验证、权限验证、资源保护等。
* 整个微服务系统有链路追踪的能力。
* 有一套完整的实时日志系统。

## 功能

* 服务的注册和发现。
* 服务的负载均衡。
* 服务的容错。
* 服务网关。
* 服务配置的统一管理。
* 链路追踪。
* 实时日志。



# 注意事项

* 分布式事务：例如购买物品，需要账号扣款和商品数量-1，这两个操作存在不同的微服务中，整个过程发起一个事务流程，通过**事务协调器TC**来保证两者都是正确执行的情况下，才执行，否则需要回滚。
* 服务的部署：服务的启动顺序和启动时机
* 微服务架构的三大难题：服务故障的传播性(服务熔断、服务降级)、服务的划分和分布式事务(两阶段或三阶段提交)

